<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Qur'on Focus OS</title>

    <!-- PWA iOS Sozlamalari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">

    <!-- 1. TAILWIND CSS (Dizayn) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. REACT (Miya) -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 3. BABEL (Kod tarjimoni) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <!-- Maxsus Konfiguratsiya -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: '#FFD700',
                        dark: '#050505',
                        panel: '#111111'
                    },
                    animation: {
                        'breathe': 'breathe 8s infinite ease-in-out',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '0.3' },
                            '50%': { transform: 'scale(1.5)', opacity: '0.6' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Asosiy uslublar */
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden; /* Scroll yo'q */
            -webkit-tap-highlight-color: transparent;
        }

        /* Glassmorphism (Shisha effekti) */
        .glass-panel {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        /* Yuklanish ekrani */
        #loader {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            color: #FFD700; font-family: monospace;
        }

        /* Slayder dizayni */
        input[type=range] {
            -webkit-appearance: none; width: 100%; background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px;
            border-radius: 50%; background: #FFD700; margin-top: -8px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #333; border-radius: 2px;
        }
    </style>
</head>
<body>
    
    <!-- Yuklanish indikatori -->
    <div id="loader">Tizim yuklanmoqda...</div>
    
    <!-- Ilova konteyneri -->
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. ICONLAR (SVG KODLARI) ---
        // Tashqi kutubxonaga bog'liq emas, 100% ishlaydi.
        const Icons = {
            Book: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Clock: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Stats: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>,
            Play: () => <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: () => <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            Reset: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Check: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>,
            Plus: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Trash: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Brain: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            Wind: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>
        };

        // --- 2. MA'LUMOTLAR ---
        const QUOTES = [
            "Allohning roziligi — eng oliy maqsaddir.",
            "Qur'on qalblarning bahoridir.",
            "Bugungi harakatingiz — ertangi natijangiz.",
            "Ilm oling, zera u qalbning nuridir.",
            "Vaqt — qaytib kelmas ne'mat."
        ];

        // --- 3. KOMPONENTLAR ---

        // 3.1 NAFAS MASHQI (Animatsion Modal)
        const BreathingExercise = ({ onComplete }) => {
            const [text, setText] = React.useState("Tayyorlaning");

            React.useEffect(() => {
                const steps = async () => {
                    setText("Chuqur nafas oling (4s)");
                    await new Promise(r => setTimeout(r, 4000));
                    setText("Nafasni ushlab turing (4s)");
                    await new Promise(r => setTimeout(r, 4000));
                    setText("Sekin chiqaring (4s)");
                    await new Promise(r => setTimeout(r, 4000));
                    onComplete();
                };
                steps();
            }, []);

            return (
                <div className="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center">
                    <div className="w-64 h-64 bg-cyan-500/20 rounded-full blur-2xl absolute animate-breathe"></div>
                    <div className="relative z-10 text-center">
                        <div className="text-cyan-400 mb-6 animate-pulse flex justify-center"><Icons.Wind /></div>
                        <h2 className="text-2xl font-light text-white tracking-widest uppercase">{text}</h2>
                    </div>
                </div>
            );
        };

        // 3.2 ASOSIY ILOVA
        const App = () => {
            // STATE (Xotira)
            const [activeTab, setActiveTab] = React.useState('focus');
            const [tasks, setTasks] = React.useState([]);
            const [stats, setStats] = React.useState({ xp: 0, lvl: 1, streak: 0, minutes: 0 });
            
            // TIMER STATE
            const [timerState, setTimerState] = React.useState('idle'); // idle, breathing, running
            const [duration, setDuration] = React.useState(20);
            const [timeLeft, setTimeLeft] = React.useState(20 * 60);

            // Xotirani yuklash
            React.useEffect(() => {
                try {
                    const t = JSON.parse(localStorage.getItem('tasks_v1') || '[]');
                    const s = JSON.parse(localStorage.getItem('stats_v1') || '{"xp":0, "lvl":1, "streak":0, "minutes":0}');
                    setTasks(t);
                    setStats(s);
                    // Loader ni o'chirish
                    document.getElementById('loader').style.display = 'none';
                } catch (e) { console.error(e); }
            }, []);

            // Xotirani saqlash
            React.useEffect(() => {
                localStorage.setItem('tasks_v1', JSON.stringify(tasks));
                localStorage.setItem('stats_v1', JSON.stringify(stats));
            }, [tasks, stats]);

            // Timer Logikasi
            React.useEffect(() => {
                let interval = null;
                if (timerState === 'running' && timeLeft > 0) {
                    interval = setInterval(() => setTimeLeft(p => p - 1), 1000);
                } else if (timeLeft === 0 && timerState === 'running') {
                    finishTimer();
                }
                return () => clearInterval(interval);
            }, [timerState, timeLeft]);

            const finishTimer = () => {
                setTimerState('idle');
                if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                
                const gainedXP = duration * 10;
                setStats(prev => ({
                    ...prev,
                    xp: prev.xp + gainedXP,
                    minutes: prev.minutes + duration,
                    lvl: Math.floor((prev.xp + gainedXP) / 500) + 1
                }));
                
                alert(`MashaAlloh! Vaqt tugadi.\n+${gainedXP} XP oldingiz.`);
                setTimeLeft(duration * 60);
            };

            const startSession = () => {
                if (navigator.vibrate) navigator.vibrate(50);
                setTimerState('breathing');
            };

            const handleBreathingComplete = () => {
                setTimerState('running');
            };

            const resetTimer = () => {
                setTimerState('idle');
                setTimeLeft(duration * 60);
            };

            // Task Logikasi
            const addTask = () => {
                const t = prompt("Vazifa nomi:");
                if (t) setTasks([...tasks, { id: Date.now(), title: t, completed: false }]);
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t));
                if (navigator.vibrate) navigator.vibrate(50);
            };

            const deleteTask = (id) => {
                if(confirm("O'chirasizmi?")) setTasks(tasks.filter(t => t.id !== id));
            };

            // --- SAHIFALAR ---

            // 1. FOCUS SAHIFASI
            const FocusTab = () => (
                <div className="flex flex-col items-center justify-center h-full pt-10 px-6 relative">
                    {/* Smart Pill */}
                    <div className="mb-10 px-4 py-2 glass-panel rounded-full flex items-center gap-2">
                        <div className="text-blue-400"><Icons.Brain /></div>
                        <span className="text-xs text-gray-300">
                            {timerState === 'running' ? "Faqat Allohga yuzlaning" : QUOTES[Math.floor(Math.random() * QUOTES.length)]}
                        </span>
                    </div>

                    {/* Timer Ring */}
                    <div className="relative mb-12">
                        <div className="w-72 h-72 rounded-full glass-panel border border-white/10 flex flex-col items-center justify-center shadow-2xl relative">
                            {/* Orqa fon porlashi */}
                            {timerState === 'running' && <div className="absolute inset-0 bg-gold/20 blur-3xl rounded-full animate-pulse-slow"></div>}
                            
                            {/* Progress Circle SVG */}
                            <svg className="absolute inset-0 w-full h-full -rotate-90 pointer-events-none">
                                <circle cx="144" cy="144" r="138" fill="transparent" stroke="#222" strokeWidth="4" />
                                <circle 
                                    cx="144" cy="144" r="138" fill="transparent" 
                                    stroke={timerState === 'running' ? '#FFD700' : '#444'} 
                                    strokeWidth="6"
                                    strokeDasharray={2 * Math.PI * 138}
                                    strokeDashoffset={2 * Math.PI * 138 * (1 - timeLeft / (duration * 60))}
                                    strokeLinecap="round"
                                    className="transition-all duration-1000"
                                />
                            </svg>

                            <div className="text-center z-10">
                                <div className="text-7xl font-bold font-mono tracking-tighter tabular-nums text-white">
                                    {Math.floor(timeLeft / 60).toString().padStart(2,'0')}:{Math.floor(timeLeft % 60).toString().padStart(2,'0')}
                                </div>
                                <div className={`text-xs font-bold tracking-[0.3em] uppercase mt-4 ${timerState === 'running' ? 'text-gold animate-pulse' : 'text-gray-500'}`}>
                                    {timerState === 'running' ? 'FOCUSING' : 'TAYYORMISIZ?'}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Controls */}
                    {timerState === 'idle' ? (
                        <div className="w-full max-w-xs animate-bounce-in">
                            <div className="flex justify-between text-xs text-gray-400 font-bold mb-2">
                                <span>DAVOMIYLIK</span>
                                <span className="text-gold">{duration} DAQIQA</span>
                            </div>
                            <input 
                                type="range" min="5" max="60" step="5" value={duration}
                                onChange={(e) => {
                                    setDuration(Number(e.target.value));
                                    setTimeLeft(Number(e.target.value) * 60);
                                }}
                                className="w-full mb-8 cursor-pointer"
                            />
                            <button onClick={startSession} className="w-full py-4 bg-gold hover:bg-yellow-400 text-black font-bold rounded-2xl shadow-lg active:scale-95 transition flex items-center justify-center gap-2">
                                <div className="w-6 h-6"><Icons.Play /></div> BOSHLASH
                            </button>
                        </div>
                    ) : (
                        <div className="flex gap-6">
                            <button onClick={() => setTimerState(timerState === 'running' ? 'paused' : 'running')} className="w-20 h-20 rounded-full bg-white text-black flex items-center justify-center active:scale-90 transition shadow-lg">
                                {timerState === 'running' ? <div className="w-8 h-8"><Icons.Pause /></div> : <div className="w-8 h-8"><Icons.Play /></div>}
                            </button>
                            <button onClick={resetTimer} className="w-20 h-20 rounded-full glass-panel text-red-500 flex items-center justify-center active:scale-90 transition border border-red-500/30">
                                <div className="w-8 h-8"><Icons.Reset /></div>
                            </button>
                        </div>
                    )}
                </div>
            );

            // 2. REJA SAHIFASI
            const PlannerTab = () => (
                <div className="h-full pt-10 px-6 pb-24 overflow-y-auto">
                    <div className="flex justify-between items-end mb-8">
                        <div>
                            <h2 className="text-3xl font-bold text-white">Reja</h2>
                            <p className="text-gray-500 text-sm mt-1">Kunlik vazifalar</p>
                        </div>
                        <button onClick={addTask} className="w-12 h-12 bg-gold rounded-full flex items-center justify-center text-black shadow-lg active:scale-90 transition">
                            <Icons.Plus />
                        </button>
                    </div>

                    <div className="space-y-3">
                        {tasks.length === 0 && (
                            <div className="text-center py-12 opacity-30">
                                <div className="mx-auto mb-3 w-12 h-12 text-gray-500"><Icons.Book /></div>
                                <p>Vazifalar yo'q</p>
                            </div>
                        )}
                        {tasks.map(task => (
                            <div 
                                key={task.id} 
                                onClick={() => toggleTask(task.id)}
                                className={`p-4 rounded-xl border transition-all active:scale-[0.98] flex items-center justify-between ${task.completed ? 'bg-green-900/10 border-green-500/30 opacity-60' : 'glass-panel border-transparent'}`}
                            >
                                <div className="flex items-center gap-4">
                                    <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors ${task.completed ? 'bg-green-500 border-green-500' : 'border-gray-500'}`}>
                                        {task.completed && <div className="text-black w-4 h-4"><Icons.Check /></div>}
                                    </div>
                                    <span className={`font-medium ${task.completed ? 'line-through text-gray-500' : 'text-white'}`}>{task.title}</span>
                                </div>
                                <button onClick={(e) => {e.stopPropagation(); deleteTask(task.id)}} className="text-gray-500 hover:text-red-500 p-2">
                                    <div className="w-5 h-5"><Icons.Trash /></div>
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );

            // 3. NATIJA SAHIFASI
            const StatsTab = () => (
                <div className="h-full pt-10 px-6">
                    <h2 className="text-3xl font-bold text-white mb-8">Natijalar</h2>
                    
                    <div className="grid grid-cols-2 gap-4 mb-6">
                        <div className="glass-panel p-5 rounded-2xl relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-3 opacity-10 text-white"><Icons.Clock /></div>
                            <p className="text-xs text-gold font-bold uppercase">Jami Vaqt</p>
                            <h3 className="text-2xl font-bold mt-1 text-white">{Math.floor(stats.minutes / 60)}h {stats.minutes % 60}m</h3>
                        </div>
                        <div className="glass-panel p-5 rounded-2xl relative overflow-hidden bg-gradient-to-br from-gray-900 to-black border-gold/20">
                            <div className="absolute top-0 right-0 p-3 opacity-10 text-gold"><Icons.Stats /></div>
                            <p className="text-xs text-gold font-bold uppercase">XP Score</p>
                            <h3 className="text-2xl font-bold mt-1 text-white">{stats.xp}</h3>
                        </div>
                    </div>

                    <div className="glass-panel p-6 rounded-2xl mb-6">
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="font-bold text-white">Daraja (Level)</h3>
                            <span className="text-xs bg-gold text-black px-2 py-1 rounded font-bold">LVL {stats.lvl}</span>
                        </div>
                        <div className="w-full bg-gray-800 h-3 rounded-full overflow-hidden">
                            <div className="bg-gold h-full transition-all duration-1000" style={{width: `${(stats.xp % 500) / 5}%`}}></div>
                        </div>
                        <p className="text-xs text-gray-500 mt-2 text-right">Keyingi darajaga {(500 - (stats.xp % 500))} XP qoldi</p>
                    </div>

                    <div className="text-center opacity-30 text-xs mt-10 text-gray-500">
                        Qur'on OS v3.0 <br/> Made by ©️Muhammad Daler
                    </div>
                </div>
            );

            // RENDER
            return (
                <div className="h-screen w-full flex flex-col bg-black text-white relative font-sans">
                    {/* Nafas Mashqi (Overlay) */}
                    {timerState === 'breathing' && <BreathingExercise onComplete={handleBreathingComplete} />}

                    {/* Orqa Fon Effektlari */}
                    <div className="fixed top-[-20%] left-[-20%] w-[80%] h-[50%] bg-purple-900/10 rounded-full blur-[120px] pointer-events-none"></div>
                    <div className="fixed bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-gold/10 rounded-full blur-[120px] pointer-events-none"></div>

                    {/* Yuqori Bar */}
                    <div className="px-6 pt-12 pb-2 flex justify-between items-center z-10">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 bg-gold rounded-lg flex items-center justify-center text-black font-bold">Q</div>
                            <span className="font-bold text-lg">Qur'on Focus</span>
                        </div>
                        <div className="text-xs text-gray-400 font-bold border border-white/10 px-2 py-1 rounded-full bg-black/50">
                            {stats.lvl}-Bosqich
                        </div>
                    </div>

                    {/* Asosiy Kontent */}
                    <div className="flex-1 relative z-10 overflow-hidden">
                        {activeTab === 'focus' && <FocusTab />}
                        {activeTab === 'planner' && <PlannerTab />}
                        {activeTab === 'stats' && <StatsTab />}
                    </div>

                    {/* Pastki Navigatsiya (Dock) */}
                    <div className="h-24 pb-6 flex items-center justify-center relative z-20">
                        <div className="glass-panel rounded-full px-6 py-3 flex items-center gap-8 shadow-2xl">
                            <button onClick={() => setActiveTab('planner')} className={`flex flex-col items-center gap-1 ${activeTab === 'planner' ? 'text-white' : 'text-gray-500'}`}>
                                <div className="w-6 h-6"><Icons.Book /></div>
                            </button>
                            
                            <button onClick={() => setActiveTab('focus')} className="relative -top-6">
                                <div className={`w-16 h-16 rounded-full flex items-center justify-center border-4 border-black shadow-lg shadow-gold/20 transition-transform ${activeTab === 'focus' ? 'bg-gold text-black scale-110' : 'bg-gray-800 text-gray-400'}`}>
                                    <div className="w-8 h-8"><Icons.Clock /></div>
                                </div>
                            </button>

                            <button onClick={() => setActiveTab('stats')} className={`flex flex-col items-center gap-1 ${activeTab === 'stats' ? 'text-white' : 'text-gray-500'}`}>
                                <div className="w-6 h-6"><Icons.Stats /></div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


