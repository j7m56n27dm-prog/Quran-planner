<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>NUR & ILM | Digital Tadabbur Pro</title>
    
    <!-- LIBRARIES (CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        /* --- CORE STYLING --- */
        @import url('https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Inter:wght@200;400;600&display=swap');

        body {
            margin: 0;
            background-color: #020202; /* Deepest Black */
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            color: #e5e7eb;
            touch-action: none; /* Prevent scroll on mobile */
            -webkit-font-smoothing: antialiased;
        }

        #canvas-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        /* --- UI OVERLAY --- */
        #ui-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
            background: radial-gradient(circle at center, transparent 0%, #000000 120%);
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            opacity: 0.7;
        }
        .status-badge {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 5px 10px;
            border: 1px solid #10b981;
            color: #10b981;
            border-radius: 4px;
            background: rgba(16, 185, 129, 0.1);
        }
        .status-badge.error { border-color: #ef4444; color: #ef4444; background: rgba(239, 68, 68, 0.1); }

        /* Center Content (Ayah) */
        .content-wrapper {
            text-align: center;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            transition: opacity 1s ease;
        }

        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: clamp(2rem, 5vw, 4rem);
            color: #fffbeb; /* Antique White */
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .divider {
            width: 50px;
            height: 1px;
            background: linear-gradient(90deg, transparent, #10b981, transparent);
            margin: 15px auto;
        }

        .uzbek-text {
            font-size: clamp(1rem, 3vw, 1.5rem);
            font-weight: 200;
            font-style: italic;
            color: #d1fae5;
            letter-spacing: 0.5px;
        }

        .meta-text {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: #059669;
            margin-top: 10px;
        }

        /* Footer (Hikmah) */
        .footer {
            margin-bottom: 20px;
            text-align: center;
            opacity: 0.8;
        }
        .hikmah-box {
            background: rgba(0, 20, 10, 0.6);
            border-left: 2px solid #10b981;
            padding: 15px;
            backdrop-filter: blur(4px);
            max-width: 600px;
            margin: 0 auto;
        }
        .hikmah-title {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #34d399;
            display: block;
            margin-bottom: 5px;
        }
        .hikmah-content {
            font-size: 12px;
            color: #9ca3af;
            line-height: 1.4;
        }

        /* Start Screen */
        #start-screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #020202;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .start-btn {
            margin-top: 30px;
            padding: 15px 40px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 4px;
            font-size: 12px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.5s;
        }
        .start-btn:hover {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }

        .hidden { opacity: 0; pointer-events: none; transition: opacity 1s; }
        .visible { opacity: 1; pointer-events: auto; }

        /* Utility */
        .pinch-alert {
            color: #fbbf24;
            font-weight: bold;
            text-shadow: 0 0 10px #fbbf24;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .pinch-active { opacity: 1; }
    </style>
</head>
<body>

    <!-- START SCREEN -->
    <div id="start-screen">
        <h1 style="font-weight: 200; letter-spacing: 8px; font-size: 32px; margin-bottom: 10px;">NUR & ILM</h1>
        <p style="font-size: 10px; color: #666; letter-spacing: 2px; text-transform: uppercase;">Digital Tadabbur Experience</p>
        <button class="start-btn" id="btn-start">Bismillah • Kirish</button>
        <p style="margin-top: 20px; font-size: 9px; color: #444;">Kamera ruxsati va Ovoz talab qilinadi.<br>Iltimos, sokin joyda foydalaning.</p>
    </div>

    <!-- MAIN UI -->
    <div id="ui-layer" class="hidden">
        <div class="header">
            <div>
                <div style="font-size: 10px; color: #333; letter-spacing: 2px;">V1.0 FINAL</div>
            </div>
            <div style="text-align: right;">
                <div id="hand-status" class="status-badge error">Qo'l izlanmoqda...</div>
                <div id="pinch-status" class="pinch-alert" style="font-size: 10px; margin-top: 5px; letter-spacing: 1px;">VAHDAT (BIRLIK)</div>
            </div>
        </div>

        <div class="content-wrapper">
            <div id="arabic" class="arabic-text"></div>
            <div class="divider"></div>
            <div id="uzbek" class="uzbek-text"></div>
            <div id="meta" class="meta-text"></div>
        </div>

        <div class="footer">
            <div class="hikmah-box">
                <span id="hikmah-source" class="hikmah-title"></span>
                <span id="hikmah-body" class="hikmah-content"></span>
            </div>
            <!-- Manual Navigation for Backup -->
            <div style="margin-top: 15px; pointer-events: auto;">
                <button onclick="app.prevAyah()" style="background:none; border:none; color:#333; font-size: 20px;">←</button>
                <button onclick="app.nextAyah()" style="background:none; border:none; color:#333; font-size: 20px;">→</button>
            </div>
        </div>
    </div>

    <!-- 3D CANVAS -->
    <div id="canvas-container"></div>
    <!-- HIDDEN VIDEO -->
    <video id="input_video" style="display:none" playsinline webkit-playsinline></video>

    <script>
        /**
         * NUR & ILM - Yagona Fayl Arxitekturasi
         * Muallif: Muhammad Daler
         * Texnologiyalar: Three.js (WebGL), Web Audio API, MediaPipe Hands
         */

        // --- 1. MA'LUMOTLAR BAZASI (DATA) ---
        const AYAHS = [
            {
                id: 1,
                surah: "An-Nur 24:35",
                arabic: "اللَّهُ نُورُ السَّمَاوَاتِ وَالْأَرْضِ",
                uzbek: "Alloh osmonlar va yerning nuridir.",
                source: "Fizika va Irfon",
                hikmah: "Koinotdagi har bir foton, har bir energiya Uning nuri tajalliysidir. Zulmat yo'q, faqat Nurning yo'qligi bor.",
                shape: 'SPHERE'
            },
            {
                id: 2,
                surah: "Al-Alaq 96:1",
                arabic: "اقْرَأْ بِاسْمِ رَبِّكَ الَّذِي خَلَقَ",
                uzbek: "Yaratgan Robbing nomi bilan o'qi!",
                source: "Ibn Sino Hikmati",
                hikmah: "Inson aqli faol bo'lganda, u Koinot Aqli bilan bog'lanadi. O'qish - neyronlarning ilohiy raqsidir.",
                shape: 'SPIRAL'
            },
            {
                id: 3,
                surah: "Al-Anbiya 21:30",
                arabic: "أَوَلَمْ يَرَ الَّذِينَ كَفَرُوا أَنَّ السَّمَاوَاتِ وَالْأَرْضَ كَانَتَا رَتْقًا فَفَتَقْنَاهُمَا",
                uzbek: "Osmonlar va Yer bitishgan edilar, Biz ularni ajratdik.",
                source: "Katta Portlash (Big Bang)",
                hikmah: "Koinot yagona o'ta zich nuqtadan kengayishni boshladi. Biz hammamiz yulduz changidan yaralganmiz.",
                shape: 'EXPANSION'
            },
            {
                id: 4,
                surah: "Az-Zumar 39:9",
                arabic: "قُلْ هَلْ يَسْتَوِي الَّذِينَ يَعْلَمُونَ وَالَّذِينَ لَا يَعْلَمُونَ",
                uzbek: "Aytgin: «Biladiganlar bilan bilmaydiganlar teng bo'lurmi?!»",
                source: "Al-Farabi",
                hikmah: "Ilm — bu shunchaki ma'lumot emas, u qalb ko'zining ochilishidir.",
                shape: 'HALO'
            },
            {
                id: 5,
                surah: "Fussilat 41:53",
                arabic: "سَنُرِيهِمْ آيَاتِنَا فِي الْآفَاقِ وَفِي أَنفُسِهِمْ",
                uzbek: "Biz ularga ufq-koinotdagi va o'z nafslaridagi belgilarimizni ko'rsaturmiz.",
                source: "Mikro va Makro Kosmos",
                hikmah: "Atomdagi elektronlarning aylanishi bilan Galaktikalar aylanishi bir xil qonuniyatga bo'ysunadi.",
                shape: 'HEART'
            }
        ];

        // --- 2. AUDIO ENGINE (Generative Sound) ---
        class AudioEngine {
            constructor() {
                this.ctx = null;
                this.osc = null;
                this.gain = null;
                this.filter = null;
                this.noise = null;
                this.noiseGain = null;
            }

            init() {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
                
                // 1. Drone (55Hz Hum) - Asosiy sokinlik ovozi
                this.osc = this.ctx.createOscillator();
                this.osc.type = 'sine';
                this.osc.frequency.value = 55; // A1 (Juda past)
                
                this.gain = this.ctx.createGain();
                this.gain.gain.value = 0.15;

                this.filter = this.ctx.createBiquadFilter();
                this.filter.type = 'lowpass';
                this.filter.frequency.value = 200;

                this.osc.connect(this.filter);
                this.filter.connect(this.gain);
                this.gain.connect(this.ctx.destination);
                this.osc.start();

                // 2. White Noise (Atmosphere/Breath)
                const bufferSize = this.ctx.sampleRate * 2;
                const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }

                this.noise = this.ctx.createBufferSource();
                this.noise.buffer = buffer;
                this.noise.loop = true;

                this.noiseGain = this.ctx.createGain();
                this.noiseGain.gain.value = 0.03;

                const noiseFilter = this.ctx.createBiquadFilter();
                noiseFilter.type = 'lowpass';
                noiseFilter.frequency.value = 400;

                this.noise.connect(noiseFilter);
                noiseFilter.connect(this.noiseGain);
                this.noiseGain.connect(this.ctx.destination);
                this.noise.start();
            }

            // Qo'l harakatiga qarab ovozni o'zgartirish
            update(velocity, pinchStrength) {
                if (!this.ctx) return;
                const t = this.ctx.currentTime;
                
                // Harakat tez bo'lsa, filtr ochiladi (shovqin ko'payadi)
                const targetFreq = 200 + (velocity * 1000);
                this.filter.frequency.setTargetAtTime(targetFreq, t, 0.1);

                // Pinch (Vahdat) bo'lsa, ovoz pasayadi (Sokinlik)
                const targetVol = 0.15 + (velocity * 0.1) - (pinchStrength * 0.1);
                this.gain.gain.setTargetAtTime(Math.max(0, targetVol), t, 0.1);
            }

            playWhoosh() {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                osc.frequency.setValueAtTime(100, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, this.ctx.currentTime + 0.4);
                g.gain.setValueAtTime(0.1, this.ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 0.4);
                osc.connect(g);
                g.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.5);
            }
        }

        // --- 3. PHYSICS & PARTICLES (High-End Logic) ---
        class ParticleSystem {
            constructor(scene) {
                this.count = 12000; // 12k zarracha (Mijoz talabi 15k, lekin iPhone uchun optimal 12k)
                this.geometry = new THREE.BufferGeometry();
                this.positions = new Float32Array(this.count * 3);
                this.targetPositions = new Float32Array(this.count * 3);
                this.colors = new Float32Array(this.count * 3);
                
                // Ranglar palitrasi (Nur va Ilm)
                const colorGold = new THREE.Color(0xFFD700);
                const colorWhite = new THREE.Color(0xFFFFFF);
                const colorBlue = new THREE.Color(0x004466);

                for (let i = 0; i < this.count; i++) {
                    const i3 = i * 3;
                    this.positions[i3] = (Math.random() - 0.5) * 10;
                    this.positions[i3+1] = (Math.random() - 0.5) * 10;
                    this.positions[i3+2] = (Math.random() - 0.5) * 10;

                    let c;
                    const rnd = Math.random();
                    if (rnd > 0.9) c = colorGold;
                    else if (rnd > 0.6) c = colorWhite;
                    else c = colorBlue;

                    this.colors[i3] = c.r;
                    this.colors[i3+1] = c.g;
                    this.colors[i3+2] = c.b;
                }

                this.geometry.setAttribute('position', new THREE.BufferAttribute(this.positions, 3));
                this.geometry.setAttribute('color', new THREE.BufferAttribute(this.colors, 3));

                this.material = new THREE.PointsMaterial({
                    size: 0.04,
                    vertexColors: true,
                    blending: THREE.AdditiveBlending,
                    depthWrite: false,
                    transparent: true,
                    opacity: 0.8
                });

                this.mesh = new THREE.Points(this.geometry, this.material);
                scene.add(this.mesh);
                
                this.generateShape('SPHERE'); // Boshlang'ich shakl
            }

            generateShape(type) {
                const arr = this.targetPositions;
                for (let i = 0; i < this.count; i++) {
                    const i3 = i * 3;
                    let x, y, z;

                    if (type === 'SPHERE') {
                        const r = 4 * Math.cbrt(Math.random());
                        const theta = Math.random() * 2 * Math.PI;
                        const phi = Math.acos(2 * Math.random() - 1);
                        x = r * Math.sin(phi) * Math.cos(theta);
                        y = r * Math.sin(phi) * Math.sin(theta);
                        z = r * Math.cos(phi);
                    } else if (type === 'SPIRAL') {
                        const angle = i * 0.05;
                        const r = 0.1 * angle;
                        x = r * Math.cos(angle);
                        y = (Math.random() - 0.5) * 1;
                        z = r * Math.sin(angle);
                    } else if (type === 'HEART') {
                         const t = Math.random() * Math.PI * 2;
                         const scale = 0.15;
                         x = 16 * Math.pow(Math.sin(t), 3) * scale * (0.8 + Math.random()*0.4);
                         y = (13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)) * scale * (0.8 + Math.random()*0.4);
                         z = (Math.random() - 0.5) * 2;
                    } else if (type === 'HALO') {
                        const angle = Math.random() * Math.PI * 2;
                        const r = 3 + (Math.random() - 0.5) * 0.5;
                        x = Math.cos(angle) * r;
                        y = Math.sin(angle) * r;
                        z = (Math.random() - 0.5) * 0.5;
                    } else { // EXPANSION
                        const r = Math.random() * 8;
                        const theta = Math.random() * 2 * Math.PI;
                        const phi = Math.acos(2 * Math.random() - 1);
                        x = r * Math.sin(phi) * Math.cos(theta);
                        y = r * Math.sin(phi) * Math.sin(theta);
                        z = r * Math.cos(phi);
                    }

                    arr[i3] = x;
                    arr[i3+1] = y;
                    arr[i3+2] = z;
                }
            }

            update(pinchStrength) {
                const pos = this.geometry.attributes.position.array;
                const target = this.targetPositions;

                // Morphing Speed
                const speed = 0.05;

                for (let i = 0; i < this.count; i++) {
                    const i3 = i * 3;
                    
                    // Standart Morphing (Nishonga intilish)
                    pos[i3] += (target[i3] - pos[i3]) * speed;
                    pos[i3+1] += (target[i3+1] - pos[i3+1]) * speed;
                    pos[i3+2] += (target[i3+2] - pos[i3+2]) * speed;

                    // PINCH PHYSICS (Gravity Implosion)
                    // Agar pinch bo'lsa, zarrachalar markazga (0,0,0) tortiladi
                    if (pinchStrength > 0) {
                        const force = pinchStrength * 0.05;
                        pos[i3] = pos[i3] * (1 - force);
                        pos[i3+1] = pos[i3+1] * (1 - force);
                        pos[i3+2] = pos[i3+2] * (1 - force);
                    }
                }
                this.geometry.attributes.position.needsUpdate = true;
                
                // Sekin aylanish (Idle)
                this.mesh.rotation.y += 0.001;
            }
        }

        // --- 4. MAIN APP CONTROLLER ---
        class App {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.particles = null;
                this.audio = new AudioEngine();
                this.currentIndex = 0;
                
                this.handDetected = false;
                this.isPinching = false;
                this.pinchDist = 1;
            }

            start() {
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('ui-layer').classList.remove('hidden');
                document.getElementById('ui-layer').classList.add('visible');

                this.initThree();
                this.initMediaPipe();
                this.audio.init();
                this.updateUI();
            }

            initThree() {
                this.scene = new THREE.Scene();
                this.scene.fog = new THREE.FogExp2(0x020202, 0.05);

                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
                this.camera.position.z = 6;

                this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                document.getElementById('canvas-container').appendChild(this.renderer.domElement);

                this.particles = new ParticleSystem(this.scene);

                const animate = () => {
                    requestAnimationFrame(animate);
                    // Fizika yangilanishi
                    const strength = this.isPinching ? Math.max(0, 1 - (this.pinchDist * 10)) : 0;
                    this.particles.update(strength);
                    this.renderer.render(this.scene, this.camera);
                };
                animate();

                window.addEventListener('resize', () => {
                    this.camera.aspect = window.innerWidth / window.innerHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            initMediaPipe() {
                const videoElement = document.getElementById('input_video');
                const handStatus = document.getElementById('hand-status');
                const pinchAlert = document.getElementById('pinch-status');

                const hands = new Hands({locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }});

                hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 1, // Full model for accuracy
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });

                hands.onResults((results) => {
                    if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                        if (!this.handDetected) {
                            this.handDetected = true;
                            handStatus.innerText = "ALOQA O'RNATILDI";
                            handStatus.classList.remove('error');
                            handStatus.style.borderColor = "#10b981";
                            handStatus.style.color = "#10b981";
                        }

                        const lm = results.multiHandLandmarks[0];
                        const palm = lm[9];
                        const thumb = lm[4];
                        const indexF = lm[8];

                        // 1. Scene Rotation (Qo'l holati)
                        // x va y 0-1 oralig'ida. 
                        const rotX = (palm.y - 0.5) * 2; 
                        const rotY = (palm.x - 0.5) * 2;
                        
                        // Smooth lerp rotation
                        this.scene.rotation.x += (rotX - this.scene.rotation.x) * 0.1;
                        this.scene.rotation.y += (rotY - this.scene.rotation.y) * 0.1;

                        // 2. Pinch Detection
                        const dist = Math.hypot(thumb.x - indexF.x, thumb.y - indexF.y);
                        this.pinchDist = dist;
                        
                        if (dist < 0.06) {
                            this.isPinching = true;
                            pinchAlert.classList.add('pinch-active');
                        } else {
                            this.isPinching = false;
                            pinchAlert.classList.remove('pinch-active');
                        }

                        // 3. Audio Control
                        const velocity = Math.abs(palm.x - 0.5); // Sodda tezlik
                        this.audio.update(velocity, this.isPinching ? 1 : 0);

                        // 4. Swipe Logic (Ayah Change)
                        // Agar qo'l juda o'ngga borsa (palm.x > 0.9)
                        // Debounce kerak (har doim o'zgarmasligi uchun)
                        if (palm.x > 0.9) this.nextAyahDebounced();
                        if (palm.x < 0.1) this.prevAyahDebounced();

                    } else {
                        if (this.handDetected) {
                            this.handDetected = false;
                            handStatus.innerText = "QO'L IZLANMOQDA...";
                            handStatus.classList.add('error');
                        }
                    }
                });

                const camera = new Camera(videoElement, {
                    onFrame: async () => {
                        await hands.send({image: videoElement});
                    },
                    width: 640, height: 480, facingMode: "user"
                });
                camera.start();
            }

            // Swipe Debounce
            lastSwipe = 0;
            nextAyahDebounced() {
                const now = Date.now();
                if (now - this.lastSwipe > 2000) {
                    this.nextAyah();
                    this.lastSwipe = now;
                }
            }
            prevAyahDebounced() {
                const now = Date.now();
                if (now - this.lastSwipe > 2000) {
                    this.prevAyah();
                    this.lastSwipe = now;
                }
            }

            nextAyah() {
                this.currentIndex = (this.currentIndex + 1) % AYAHS.length;
                this.updateUI();
                this.particles.generateShape(AYAHS[this.currentIndex].shape);
                this.audio.playWhoosh();
            }

            prevAyah() {
                this.currentIndex = (this.currentIndex - 1 + AYAHS.length) % AYAHS.length;
                this.updateUI();
                this.particles.generateShape(AYAHS[this.currentIndex].shape);
                this.audio.playWhoosh();
            }

            updateUI() {
                const data = AYAHS[this.currentIndex];
                document.getElementById('arabic').innerText = data.arabic;
                document.getElementById('uzbek').innerText = `"${data.uzbek}"`;
                document.getElementById('meta').innerText = data.surah;
                document.getElementById('hikmah-source').innerText = `— ${data.source}`;
                document.getElementById('hikmah-body').innerText = data.hikmah;
            }
        }

        // --- INIT ---
        const app = new App();
        document.getElementById('btn-start').addEventListener('click', () => app.start());

    </script>
</body>
</html>

Birinchi bergan kodimdan hechnima ozgartirilmasin

Agar xatoliklar bolsa togrla

<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>NUR & ILM | Digital Tadabbur Pro</title>
    
    <!-- LIBRARIES (CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        /* --- CORE STYLING --- */
        @import url('https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Inter:wght@200;400;600&display=swap');

        body {
            margin: 0;
            background-color: #020202; /* Deepest Black */
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            color: #e5e7eb;
            touch-action: none; /* Prevent scroll on mobile */
            -webkit-font-smoothing: antialiased;
        }

        #canvas-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        /* --- UI OVERLAY --- */
        #ui-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
            background: radial-gradient(circle at center, transparent 0%, #000000 120%);
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            opacity: 0.7;
        }
        .status-badge {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 5px 10px;
            border: 1px solid #10b981;
            color: #10b981;
            border-radius: 4px;
            background: rgba(16, 185, 129, 0.1);
        }
        .status-badge.error { border-color: #ef4444; color: #ef4444; background: rgba(239, 68, 68, 0.1); }

        /* Center Content (Ayah) */
        .content-wrapper {
            text-align: center;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            transition: opacity 1s ease;
        }

        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: clamp(2rem, 5vw, 4rem);
            color: #fffbeb; /* Antique White */
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .divider {
            width: 50px;
            height: 1px;
            background: linear-gradient(90deg, transparent, #10b981, transparent);
            margin: 15px auto;
        }

        .uzbek-text {
            font-size: clamp(1rem, 3vw, 1.5rem);
            font-weight: 200;
            font-style: italic;
            color: #d1fae5;
            letter-spacing: 0.5px;
        }

        .meta-text {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: #059669;
            margin-top: 10px;
        }

        /* Footer (Hikmah) */
        .footer {
            margin-bottom: 20px;
            text-align: center;
            opacity: 0.8;
        }
        .hikmah-box {
            background: rgba(0, 20, 10, 0.6);
            border-left: 2px solid #10b981;
            padding: 15px;
            backdrop-filter: blur(4px);
            max-width: 600px;
            margin: 0 auto;
        }
        .hikmah-title {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #34d399;
            display: block;
            margin-bottom: 5px;
        }
        .hikmah-content {
            font-size: 12px;
            color: #9ca3af;
            line-height: 1.4;
        }

        /* Start Screen */
        #start-screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #020202;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .start-btn {
            margin-top: 30px;
            padding: 15px 40px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 4px;
            font-size: 12px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.5s;
        }
        .start-btn:hover {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }

        .hidden { opacity: 0; pointer-events: none; transition: opacity 1s; }
        .visible { opacity: 1; pointer-events: auto; }

        /* Utility */
        .pinch-alert {
            color: #fbbf24;
            font-weight: bold;
            text-shadow: 0 0 10px #fbbf24;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .pinch-active { opacity: 1; }
    </style>
</head>
<body>

    <!-- START SCREEN -->
    <div id="start-screen">
        <h1 style="font-weight: 200; letter-spacing: 8px; font-size: 32px; margin-bottom: 10px;">NUR & ILM</h1>
        <p style="font-size: 10px; color: #666; letter-spacing: 2px; text-transform: uppercase;">Digital Tadabbur Experience</p>
        <button class="start-btn" id="btn-start">Bismillah • Kirish</button>
        <p style="margin-top: 20px; font-size: 9px; color: #444;">Kamera ruxsati va Ovoz talab qilinadi.<br>Iltimos, sokin joyda foydalaning.</p>
    </div>

    <!-- MAIN UI -->
    <div id="ui-layer" class="hidden">
        <div class="header">
            <div>
                <div style="font-size: 10px; color: #333; letter-spacing: 2px;">V1.0 FINAL</div>
            </div>
            <div style="text-align: right;">
                <div id="hand-status" class="status-badge error">Qo'l izlanmoqda...</div>
                <div id="pinch-status" class="pinch-alert" style="font-size: 10px; margin-top: 5px; letter-spacing: 1px;">VAHDAT (BIRLIK)</div>
            </div>
        </div>

        <div class="content-wrapper">
            <div id="arabic" class="arabic-text"></div>
            <div class="divider"></div>
            <div id="uzbek" class="uzbek-text"></div>
            <div id="meta" class="meta-text"></div>
        </div>

        <div class="footer">
            <div class="hikmah-box">
                <span id="hikmah-source" class="hikmah-title"></span>
                <span id="hikmah-body" class="hikmah-content"></span>
            </div>
            <!-- Manual Navigation for Backup -->
            <div style="margin-top: 15px; pointer-events: auto;">
                <button onclick="app.prevAyah()" style="background:none; border:none; color:#333; font-size: 20px;">←</button>
                <button onclick="app.nextAyah()" style="background:none; border:none; color:#333; font-size: 20px;">→</button>
            </div>
        </div>
    </div>

    <!-- 3D CANVAS -->
    <div id="canvas-container"></div>
    <!-- HIDDEN VIDEO -->
    <video id="input_video" style="display:none" playsinline webkit-playsinline></video>

    <script>
        /**
         * NUR & ILM - Yagona Fayl Arxitekturasi
         * Muallif: Muhammad Daler
         * Texnologiyalar: Three.js (WebGL), Web Audio API, MediaPipe Hands
         */

        // --- 1. MA'LUMOTLAR BAZASI (DATA) ---
        const AYAHS = [
            {
                id: 1,
                surah: "An-Nur 24:35",
                arabic: "اللَّهُ نُورُ السَّمَاوَاتِ وَالْأَرْضِ",
                uzbek: "Alloh osmonlar va yerning nuridir.",
                source: "Fizika va Irfon",
                hikmah: "Koinotdagi har bir foton, har bir energiya Uning nuri tajalliysidir. Zulmat yo'q, faqat Nurning yo'qligi bor.",
                shape: 'SPHERE'
            },
            {
                id: 2,
                surah: "Al-Alaq 96:1",
                arabic: "اقْرَأْ بِاسْمِ رَبِّكَ الَّذِي خَلَقَ",
                uzbek: "Yaratgan Robbing nomi bilan o'qi!",
                source: "Ibn Sino Hikmati",
                hikmah: "Inson aqli faol bo'lganda, u Koinot Aqli bilan bog'lanadi. O'qish - neyronlarning ilohiy raqsidir.",
                shape: 'SPIRAL'
            },
            {
                id: 3,
                surah: "Al-Anbiya 21:30",