<!DOCTYPE html>
<html lang="uz" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#001F18">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Nur Parvozi | Ultimate Focus & Quran</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;500;700&family=Outfit:wght@300;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES & THEME --- */
        :root {
            --primary: #00E676; /* Neon Emerald */
            --primary-dark: #004D40;
            --accent: #FFD700; /* Islamic Gold */
            --bg-deep: #00100D;
            --bg-glass: rgba(16, 30, 26, 0.75);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #FFFFFF;
            --text-muted: #A0B3B0;
            --danger: #FF5252;
            --font-main: 'Outfit', 'Inter', sans-serif;
            --font-arabic: 'Amiri', serif;
            --shadow-neon: 0 0 20px rgba(0, 230, 118, 0.3);
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            --ease-elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 230, 118, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 215, 0, 0.05) 0%, transparent 20%);
            color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ANIMATIONS --- */
        @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 1; filter: drop-shadow(0 0 15px var(--primary)); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes tawaf { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- GLASSMORPHISM UTILS --- */
        .glass-panel {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        /* --- LAYOUT --- */
        #app { flex: 1; position: relative; overflow-y: auto; scroll-behavior: smooth; padding-bottom: 80px; }
        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        
        /* --- COMPONENTS --- */
        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px; z-index: 10; }
        .logo { font-size: 1.5rem; font-weight: 700; background: linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Mood Selector */
        .mood-scroller { display: flex; gap: 15px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .mood-chip {
            padding: 10px 20px; border-radius: 50px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            white-space: nowrap; transition: var(--transition); cursor: pointer;
        }
        .mood-chip.active { background: var(--primary); color: #000; box-shadow: var(--shadow-neon); font-weight: 600; }

        /* Dashboard Cards */
        .card { padding: 20px; margin-bottom: 20px; position: relative; overflow: hidden; animation: slideIn 0.5s ease; }
        .card-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 10px; }
        .card-content { font-size: 1.2rem; line-height: 1.5; }
        
        /* Ayah Display */
        .ayah-arabic { font-family: var(--font-arabic); font-size: 1.8rem; text-align: right; line-height: 2; margin-bottom: 15px; color: var(--accent); }
        .ayah-trans { font-size: 1rem; font-style: italic; color: var(--text-muted); }

        /* Focus Mode (Nur Parvozi) */
        #focus-overlay {
            position: fixed; inset: 0; background: #000; z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .orbit-container { width: 300px; height: 300px; position: relative; margin-bottom: 40px; transform-style: preserve-3d; perspective: 1000px; }
        .kaba-core { 
            width: 60px; height: 80px; background: #000; border: 2px solid var(--accent); position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); box-shadow: 0 0 50px rgba(255, 215, 0, 0.2); 
        }
        .orbit-ring {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 1px dashed rgba(255,255,255,0.2); border-radius: 50%;
        }
        .plane-icon { font-size: 24px; position: absolute; color: var(--primary); transition: all 1s linear; text-shadow: 0 0 10px var(--primary); }

        /* Navigation */
        .nav-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px;
            display: flex; justify-content: space-around; padding: 15px; z-index: 50;
        }
        .nav-item { color: var(--text-muted); display: flex; flex-direction: column; align-items: center; font-size: 0.7rem; gap: 5px; opacity: 0.7; transition: var(--transition); }
        .nav-item.active { color: var(--primary); opacity: 1; transform: translateY(-5px); }
        .nav-item i { font-size: 1.5rem; }

        /* Utilities */
        .btn-main {
            width: 100%; padding: 18px; border-radius: 16px; border: none; background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: #fff; font-size: 1.1rem; font-weight: 600; cursor: pointer; box-shadow: var(--shadow-neon); transition: var(--transition);
        }
        .btn-main:active { transform: scale(0.98); }
        .hidden { display: none !important; }
        
        /* RTL Fixes */
        html[dir="rtl"] .ayah-arabic { text-align: center; } /* Artistic choice */

        /* Canvas for Sharing */
        #shareCanvas { display: none; }
    </style>
</head>
<body>

    <header>
        <div class="logo">
            <span style="color:var(--text-main)">Nur</span>Parvozi
        </div>
        <div class="user-streak" style="display:flex; align-items:center; gap:5px;">
            <i class="material-icons-round" style="color:var(--accent)">local_fire_department</i>
            <span id="streak-count">0</span>
        </div>
    </header>

    <div id="app">
        </div>

    <nav class="nav-bar glass-panel">
        <div class="nav-item active" onclick="app.router('home')">
            <i class="material-icons-round">home</i>
            <span data-i18n="nav_home">Qalb</span>
        </div>
        <div class="nav-item" onclick="app.router('hifz')">
            <i class="material-icons-round">menu_book</i>
            <span data-i18n="nav_hifz">Hifz</span>
        </div>
        <div class="nav-item" onclick="app.router('focus')">
            <div style="background:var(--primary); border-radius:50%; padding:10px; margin-top:-25px; box-shadow: 0 0 15px var(--primary);">
                <i class="material-icons-round" style="color:#000">flight_takeoff</i>
            </div>
            <span data-i18n="nav_focus" style="margin-top:5px">Parvoz</span>
        </div>
        <div class="nav-item" onclick="app.router('planner')">
            <i class="material-icons-round">event_note</i>
            <span data-i18n="nav_plan">Reja</span>
        </div>
        <div class="nav-item" onclick="app.router('settings')">
            <i class="material-icons-round">settings</i>
            <span data-i18n="nav_settings">Sozlama</span>
        </div>
    </nav>

    <div id="focus-overlay">
        <div style="text-align:center; color:white; z-index:2;">
            <h2 id="focus-timer" style="font-size: 4rem; font-weight: 300; font-family: monospace;">25:00</h2>
            <p id="focus-status" style="opacity:0.7; letter-spacing:2px;">KA'BA TOMON PARVOZ...</p>
        </div>
        
        <div class="orbit-container">
            <div class="kaba-core"></div>
            <div id="plane-tracker" class="plane-icon"><i class="material-icons-round">flight</i></div>
        </div>

        <button class="btn-main" style="width:200px; background: rgba(255,255,255,0.1);" onclick="focusEngine.stopSession()">
            Parvozni Yakunlash
        </button>
    </div>

    <div id="shield-modal" class="glass-panel" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:400px; padding:30px; text-align:center; z-index:200; display:none; border: 1px solid var(--danger);">
        <i class="material-icons-round" style="font-size:4rem; color:var(--danger); margin-bottom:20px;">front_hand</i>
        <h3>To'xtang!</h3>
        <p style="margin:15px 0; color:var(--text-muted);">Hozir shayton sizni chalg'itmoqchi. Chuqur nafas oling.</p>
        <div id="breath-guide" style="font-size:1.5rem; color:var(--primary); font-weight:bold; margin:20px 0;">SubhanAllah</div>
        <button class="btn-main" onclick="focusEngine.resumeFocus()">Parvozga qaytish</button>
    </div>

    <script>
        /* --- 1. DATA & CONTENT (HARDCODED I18N) --- */
        const DB = {
            langs: {
                uz: {
                    nav_home: "Qalb", nav_hifz: "Hifz", nav_focus: "Parvoz", nav_plan: "Reja", nav_settings: "Sozlama",
                    greeting: "Assalomu alaykum", mood_q: "Qalbingiz qanday holatda?",
                    mood_anxious: "Siqilgan", mood_grateful: "Shukrli", mood_lazy: "G'aflatda", mood_repent: "Tavba",
                    start_focus: "Nur Parvozini Boshlash",
                    daily_plan: "Bugungi Ruhoniy Reja",
                    hifz_due: "Takrorlash vaqti keldi",
                    quote_credit: "Hikmat",
                    made_by: "Made by ©️ Muhammad Daler"
                },
                en: {
                    nav_home: "Heart", nav_hifz: "Hifz", nav_focus: "Flight", nav_plan: "Plan", nav_settings: "Settings",
                    greeting: "Peace be upon you", mood_q: "How is your heart?",
                    mood_anxious: "Anxious", mood_grateful: "Grateful", mood_lazy: "Lazy", mood_repent: "Repentant",
                    start_focus: "Start Light Flight", daily_plan: "Daily Spiritual Plan", hifz_due: "Due for Review", quote_credit: "Wisdom", made_by: "Made by ©️ Muhammad Daler"
                }
            },
            
            // Content Database (Smart Tagged)
            content: [
                {
                    id: 1, type: "ayah", tags: ["anxious", "general"],
                    ar: "أَلَا بِذِكْرِ اللَّهِ تَطْمَئِنُّ الْقُلُوبُ",
                    uz: "Ogoh bo‘lingki, Allohni zikr etish bilan qalblar orom olur.",
                    ref: "Ra'd, 28"
                },
                {
                    id: 2, type: "ayah", tags: ["grateful", "success"],
                    ar: "لَئِن شَكَرْتُمْ لَأَزِيدَنَّكُمْ",
                    uz: "Qasamki, agar shukr qilsangiz, albatta, sizga ziyoda qilurman.",
                    ref: "Ibrohim, 7"
                },
                {
                    id: 3, type: "ayah", tags: ["lazy", "motivation"],
                    ar: "وَأَن لَّيْسَ لِلْإِنسَانِ إِلَّا مَا سَعَىٰ",
                    uz: "Inson uchun faqat o‘zi qilgan harakatigina bo‘lur.",
                    ref: "Najm, 39"
                },
                {
                    id: 4, type: "dua", tags: ["repent", "night"],
                    ar: "اللَّهُمَّ إِنَّكَ عَفُوٌّ تُحِبُّ الْعَفْوَ فَاعْفُ عَنِّي",
                    uz: "Allohim, Sen afv qilguvchisan, afvni yaxshi ko‘rasan, meni afv etgin.",
                    ref: "Termiziy"
                },
                {
                    id: 5, type: "wisdom", tags: ["focus", "ilm"],
                    ar: "العلم بلا عمل كالشجر بلا ثمر",
                    uz: "Amalsiz ilm – mevasiz daraxt kabidir.",
                    ref: "Hikmat"
                }
            ],

            // Planner Logic (Islamic Bio-Rhythm)
            plannerTemplate: [
                { time: "Fajr", energy: "high", task: "Yangi Hifz (15 daq)", type: "hifz" },
                { time: "Dhuhr", energy: "med", task: "Tadabbur (1 oyat)", type: "read" },
                { time: "Asr", energy: "med", task: "Istig'for (100x)", type: "zikr" },
                { time: "Maghrib", energy: "low", task: "Oila va shukr", type: "social" },
                { time: "Isha", energy: "high", task: "Mulk surasi & Reja", type: "review" }
            ]
        };

        /* --- 2. CORE CLASSES --- */

        class AppState {
            constructor() {
                this.lang = localStorage.getItem('np_lang') || 'uz';
                this.mood = 'neutral';
                this.streak = parseInt(localStorage.getItem('np_streak') || 0);
                this.hifzData = JSON.parse(localStorage.getItem('np_hifz') || '[]');
                this.lastVisit = localStorage.getItem('np_lastVisit');
                
                this.checkStreak();
            }

            checkStreak() {
                const today = new Date().toDateString();
                if (this.lastVisit !== today) {
                    // Logic to check if consecutive days
                    this.streak++; // Simplified for demo
                    localStorage.setItem('np_streak', this.streak);
                    localStorage.setItem('np_lastVisit', today);
                }
                document.getElementById('streak-count').innerText = this.streak;
            }

            t(key) {
                return DB.langs[this.lang][key] || key;
            }
        }

        class FocusEngine {
            constructor() {
                this.isActive = false;
                this.timeLeft = 25 * 60;
                this.timerInterval = null;
                this.audioCtx = null;
                this.oscillator = null;
            }

            startSession(minutes = 25) {
                this.isActive = true;
                this.timeLeft = minutes * 60;
                document.getElementById('focus-overlay').style.display = 'flex';
                this.startAudio();
                
                this.timerInterval = setInterval(() => {
                    this.tick();
                }, 1000);

                // Anti-Distraction Listener
                document.addEventListener('visibilitychange', this.handleDistraction);
            }

            tick() {
                if (this.timeLeft <= 0) {
                    this.completeSession();
                    return;
                }
                this.timeLeft--;
                const m = Math.floor(this.timeLeft / 60).toString().padStart(2, '0');
                const s = (this.timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('focus-timer').innerText = `${m}:${s}`;
                
                // 3D Parallax Plane Movement calculation
                const progress = 1 - (this.timeLeft / (25*60));
                const angle = progress * 360; // Full orbit around Ka'ba
                const plane = document.getElementById('plane-tracker');
                
                // Math to orbit
                const radius = 100;
                const x = Math.cos(angle * (Math.PI/180)) * radius;
                const y = Math.sin(angle * (Math.PI/180)) * radius;
                
                plane.style.transform = `translate(${x}px, ${y}px) rotate(${angle}deg)`;
            }

            handleDistraction = () => {
                if (document.hidden && this.isActive) {
                    // Pause audio? No, keep playing to remind them.
                    this.triggerShield();
                }
            }

            triggerShield() {
                const modal = document.getElementById('shield-modal');
                modal.style.display = 'block';
                // Trigger Vibration
                if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                
                // Speech
                const utter = new SpeechSynthesisUtterance("Qalbingizni asrang. Parvozga qayting.");
                utter.lang = app.state.lang === 'uz' ? 'uz-UZ' : 'en-US';
                speechSynthesis.speak(utter);
            }

            resumeFocus() {
                document.getElementById('shield-modal').style.display = 'none';
            }

            stopSession() {
                clearInterval(this.timerInterval);
                this.stopAudio();
                this.isActive = false;
                document.getElementById('focus-overlay').style.display = 'none';
                document.removeEventListener('visibilitychange', this.handleDistraction);
                app.state.streak += 1; // Bonus
                app.render('home'); // Go back home
            }

            completeSession() {
                this.stopSession();
                alert("Alhamdulillah! Parvoz muvaffaqiyatli yakunlandi.");
            }

            // Web Audio API for Pink Noise (Deep Focus)
            startAudio() {
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.audioCtx = new AudioContext();
                    const bufferSize = 4096;
                    const pinkNoise = (function() {
                        let b0, b1, b2, b3, b4, b5, b6;
                        b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;
                        const node = this.audioCtx.createScriptProcessor(bufferSize, 1, 1);
                        node.onaudioprocess = function(e) {
                            const output = e.outputBuffer.getChannelData(0);
                            for (let i = 0; i < bufferSize; i++) {
                                const white = Math.random() * 2 - 1;
                                b0 = 0.99886 * b0 + white * 0.0555179;
                                b1 = 0.99332 * b1 + white * 0.0750759;
                                b2 = 0.96900 * b2 + white * 0.1538520;
                                b3 = 0.86650 * b3 + white * 0.3104856;
                                b4 = 0.55000 * b4 + white * 0.5329522;
                                b5 = -0.7616 * b5 - white * 0.0168980;
                                output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
                                output[i] *= 0.11; // Volume
                                b6 = white * 0.115926;
                            }
                        };
                        return node;
                    }).call(this);
                    pinkNoise.connect(this.audioCtx.destination);
                    this.oscillator = pinkNoise;
                } catch (e) { console.log("Audio not supported"); }
            }
            
            stopAudio() {
                if (this.audioCtx) this.audioCtx.close();
            }
        }

        /* --- 3. MAIN LOGIC --- */

        const app = {
            state: new AppState(),
            container: document.getElementById('app'),

            init() {
                this.render('home');
                this.setupServiceWorker();
                // Dynamic Mood Background
                this.updateTheme('neutral');
            },

            router(route) {
                // Remove active class from nav
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                // Simple router logic
                if (route === 'home') this.renderHome();
                if (route === 'hifz') this.renderHifz();
                if (route === 'focus') this.renderFocusPrep(); // Not direct start
                if (route === 'planner') this.renderPlanner();
                if (route === 'settings') this.renderSettings();
            },

            render(route) { this.router(route); },

            // --- VIEW RENDERERS ---

            renderHome() {
                const s = this.state;
                // Get relevant content based on mood
                const content = DB.content.filter(i => i.tags.includes(s.mood) || i.tags.includes('general'))[0];
                
                this.container.innerHTML = `
                    <div class="container">
                        <h2 style="margin-bottom:15px">${s.t('greeting')}, Musofir.</h2>
                        
                        <div class="glass-panel" style="padding:15px; margin-bottom:25px;">
                            <p style="margin-bottom:10px; opacity:0.8">${s.t('mood_q')}</p>
                            <div class="mood-scroller">
                                <div class="mood-chip" onclick="app.setMood('anxious')">${s.t('mood_anxious')}</div>
                                <div class="mood-chip" onclick="app.setMood('grateful')">${s.t('mood_grateful')}</div>
                                <div class="mood-chip" onclick="app.setMood('lazy')">${s.t('mood_lazy')}</div>
                                <div class="mood-chip" onclick="app.setMood('repent')">${s.t('mood_repent')}</div>
                            </div>
                        </div>

                        <div class="card glass-panel" style="border-left: 4px solid var(--accent)">
                            <div class="card-title">${content.type === 'ayah' ? 'OYAT' : 'HIKMAT'}</div>
                            <div class="ayah-arabic">${content.ar}</div>
                            <div class="card-content">${content.uz}</div>
                            <div style="margin-top:10px; font-size:0.8rem; color:var(--primary); text-align:right">${content.ref}</div>
                            
                            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:15px;">
                                <button onclick="app.speak('${content.ar}')" style="background:none; border:none; color:white;"><i class="material-icons-round">volume_up</i></button>
                                <button style="background:none; border:none; color:white;"><i class="material-icons-round">share</i></button>
                            </div>
                        </div>

                        <button class="btn-main" onclick="app.router('focus')">
                            <i class="material-icons-round" style="vertical-align:middle">flight_takeoff</i>
                            ${s.t('start_focus')}
                        </button>
                        
                        <div style="text-align:center; margin-top:30px; opacity:0.5; font-size:0.8rem;">
                            ${s.t('made_by')}
                        </div>
                    </div>
                `;
            },

            renderHifz() {
                // Adaptive Spaced Repetition View
                this.container.innerHTML = `
                    <div class="container">
                        <h2>Mening Hifzim</h2>
                        <div class="glass-panel card">
                            <div style="display:flex; justify-content:space-between;">
                                <span>Fotiha</span>
                                <span style="color:var(--primary)">A'lo</span>
                            </div>
                            <div style="height:5px; background:#333; margin-top:5px; border-radius:3px;">
                                <div style="width:90%; height:100%; background:var(--primary); border-radius:3px;"></div>
                            </div>
                        </div>
                        
                        <h3>Bugungi Takrorlash (Ebbinghaus)</h3>
                        ${DB.content.slice(0,3).map(c => `
                            <div class="card glass-panel" style="margin-top:10px;">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <div>
                                        <div style="font-weight:bold">${c.ref}</div>
                                        <div style="font-size:0.8rem; opacity:0.7">Keyingi: 2 kundan keyin</div>
                                    </div>
                                    <i class="material-icons-round" style="color:var(--accent)">check_circle</i>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            },

            renderFocusPrep() {
                this.container.innerHTML = `
                    <div class="container" style="text-align:center; padding-top:50px;">
                        <i class="material-icons-round" style="font-size:4rem; color:var(--primary); animation: breathe 3s infinite;">fingerprint</i>
                        <h2 style="margin:20px 0;">Niyatni yangilang</h2>
                        <p style="opacity:0.8; margin-bottom:40px;">Ushbu vaqtni Alloh roziligi uchun ilm va ibodatga bag'ishlayman.</p>
                        
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:30px;">
                            <div class="glass-panel" style="padding:20px; border:1px solid var(--primary);" onclick="focusEngine.startSession(25)">
                                <h3>25 daq</h3>
                                <small>Chuqur Diqqat</small>
                            </div>
                            <div class="glass-panel" style="padding:20px;" onclick="focusEngine.startSession(45)">
                                <h3>45 daq</h3>
                                <small>Ilmiy sessiya</small>
                            </div>
                        </div>
                    </div>
                `;
            },

            renderPlanner() {
                this.container.innerHTML = `
                    <div class="container">
                        <h2>${this.state.t('daily_plan')}</h2>
                        <p style="font-size:0.9rem; margin-bottom:20px; color:var(--accent)">Bio-Ritm: Sizda hozir 'Asr' energiyasi.</p>
                        
                        ${DB.plannerTemplate.map(task => `
                            <div class="glass-panel" style="padding:15px; margin-bottom:10px; display:flex; align-items:center; gap:15px; border-left: 3px solid ${task.energy === 'high' ? 'var(--primary)' : 'gray'}">
                                <div style="font-size:0.8rem; width:50px;">${task.time}</div>
                                <div style="flex:1;">${task.task}</div>
                                <input type="checkbox" style="transform:scale(1.5); accent-color:var(--primary)">
                            </div>
                        `).join('')}
                    </div>
                `;
            },
            
            renderSettings() {
                this.container.innerHTML = `
                    <div class="container">
                        <h2>Sozlamalar</h2>
                        <div class="glass-panel" style="padding:20px;">
                            <div style="margin-bottom:15px">
                                <label>Til / Language</label>
                                <select onchange="app.changeLang(this.value)" style="width:100%; padding:10px; margin-top:5px; background:#000; color:#fff; border:1px solid #333">
                                    <option value="uz" ${this.state.lang === 'uz' ? 'selected' : ''}>O'zbekcha</option>
                                    <option value="en" ${this.state.lang === 'en' ? 'selected' : ''}>English</option>
                                </select>
                            </div>
                            <div style="font-size:0.8rem; opacity:0.5; margin-top:20px;">Versiya 2.0 (Ultra) | Offline Ready</div>
                        </div>
                    </div>
                `;
            },

            // --- ACTIONS ---

            setMood(mood) {
                this.state.mood = mood;
                // Change UI Colors dynamically
                if(mood === 'anxious') document.documentElement.style.setProperty('--primary', '#00E676'); // Calm Green
                if(mood === 'repent') document.documentElement.style.setProperty('--primary', '#7C4DFF'); // Spiritual Purple
                
                this.render('home');
            },

            changeLang(lang) {
                this.state.lang = lang;
                localStorage.setItem('np_lang', lang);
                window.location.reload();
            },

            speak(text) {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ar-SA';
                speechSynthesis.speak(u);
            },

            setupServiceWorker() {
                if ('serviceWorker' in navigator) {
                    // Simple inline SW logic for copy-paste ability
                    // In real deployment, this goes to sw.js
                    console.log("PWA Ready");
                }
            }
        };

        const focusEngine = new FocusEngine();

        // Initialize
        window.onload = () => app.init();

    </script>
</body>
</html>
